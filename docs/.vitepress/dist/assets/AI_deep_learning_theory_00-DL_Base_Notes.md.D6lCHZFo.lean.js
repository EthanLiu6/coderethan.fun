import{_ as e,c as s,o as t,a2 as n}from"./chunks/framework.DA-Pb-tg.js";const h=JSON.parse('{"title":"ä¸€. DL_Base_Notes","description":"","frontmatter":{},"headers":[],"relativePath":"AI/deep_learning_theory/00-DL_Base_Notes.md","filePath":"AI/deep_learning_theory/00-DL_Base_Notes.md","lastUpdated":null}'),r={name:"AI/deep_learning_theory/00-DL_Base_Notes.md"};function o(i,a,l,p,c,m){return t(),s("div",null,a[0]||(a[0]=[n('<h1 id="ä¸€-dl-base-notes" tabindex="-1">ä¸€. DL_Base_Notes <a class="header-anchor" href="#ä¸€-dl-base-notes" aria-label="Permalink to &quot;ä¸€. DL_Base_Notes&quot;">â€‹</a></h1><h2 id="_1-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸnormalization" tabindex="-1">1. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸNormalization <a class="header-anchor" href="#_1-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸnormalization" aria-label="Permalink to &quot;1. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸNormalization&quot;">â€‹</a></h2><p>Batch Normï¼ŒLayer Normï¼ŒInstance Normï¼ŒGroup Norm</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mfrac><mrow><mi>x</mi><mo>âˆ’</mo><mrow><mi mathvariant="normal">E</mi></mrow><mo>[</mo><mi>x</mi><mo>]</mo></mrow><mrow><msqrt><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mo>[</mo><mi>x</mi><mo>]</mo><mo>+</mo><mi>Ïµ</mi></mrow></msqrt></mrow></mfrac><mo>âˆ—</mo><mi>Î³</mi><mo>+</mo><mi>Î²</mi></mrow><annotation encoding="application/x-tex">y = \\frac{x - \\mathrm{E}[x]}{ \\sqrt{\\mathrm{Var}[x] + \\epsilon}} * \\gamma + \\beta </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.427em;"></span><span class="strut bottom" style="height:2.55701em;vertical-align:-1.13001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.825005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.04500500000000007em;"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">âˆš</span></span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">r</span></span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord mathit">Ïµ</span></span></span><span style="top:-0.855005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord textstyle uncramped"><span class="mord mathrm">E</span></span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">âˆ—</span><span class="mord mathit" style="margin-right:0.05556em;">Î³</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.05278em;">Î²</span></span></span></span></span></p><p><a href="https://blog.csdn.net/LoseInVain/article/details/86476010" target="_blank" rel="noreferrer">Batch Normçš„æŠ€æœ¯åšå®¢</a></p><p><strong>æ€è€ƒï¼šåœ¨è®­ç»ƒå’Œæ¨ç†æ—¶æœ‰ä½•ä¸åŒï¼Ÿï¼Ÿï¼Ÿ</strong></p><h2 id="_2-ğŸŒŸğŸŒŸğŸŒŸactivation" tabindex="-1">2. ğŸŒŸğŸŒŸğŸŒŸActivation <a class="header-anchor" href="#_2-ğŸŒŸğŸŒŸğŸŒŸactivation" aria-label="Permalink to &quot;2. ğŸŒŸğŸŒŸğŸŒŸActivation&quot;">â€‹</a></h2><h3 id="_2-1-non-linear-activations-çš„ä¸¤ç§ç±»å‹" tabindex="-1">2.1 Non-linear Activations çš„ä¸¤ç§ç±»å‹ <a class="header-anchor" href="#_2-1-non-linear-activations-çš„ä¸¤ç§ç±»å‹" aria-label="Permalink to &quot;2.1 Non-linear Activations çš„ä¸¤ç§ç±»å‹&quot;">â€‹</a></h3><p>ä¸€ç§æ˜¯é€å…ƒç´ æ“ä½œï¼ˆElement wise æˆ–è€…Point wiseï¼‰ï¼Œeg:ReLU,Sigmoid,Tanh,ç­‰ï¼Œå¦ä¸€ç§æ˜¯æ“ä½œå¯¹è±¡ï¼ˆå…ƒç´ ï¼‰ä¹‹é—´å…·æœ‰ç›¸å…³æ€§ï¼Œeg.Softmax</p><h3 id="_2-2" tabindex="-1">2.2 <a class="header-anchor" href="#_2-2" aria-label="Permalink to &quot;2.2&quot;">â€‹</a></h3><h2 id="_3-ğŸŒŸloss-function" tabindex="-1">3. ğŸŒŸLoss Function <a class="header-anchor" href="#_3-ğŸŒŸloss-function" aria-label="Permalink to &quot;3. ğŸŒŸLoss Function&quot;">â€‹</a></h2><h2 id="_4-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸoptimizer" tabindex="-1">4. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸOptimizer <a class="header-anchor" href="#_4-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸoptimizer" aria-label="Permalink to &quot;4. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸOptimizer&quot;">â€‹</a></h2><blockquote><p>åŠ¨é‡åé¢çš„Admwé‚£äº›æ®ä¼°è®¡å¿˜äº†</p></blockquote><h2 id="_5-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸå›é¡¾attention" tabindex="-1">5. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸå›é¡¾Attention <a class="header-anchor" href="#_5-ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸå›é¡¾attention" aria-label="Permalink to &quot;5. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸå›é¡¾Attention&quot;">â€‹</a></h2> Attention(Q, K, V ) = softmax(\\frac{QÂ·K^T}{\\sqrt{d_k}})V <h3 id="_5-1-ä¸ºå•¥attentionçš„æ—¶å€™è¦é™¤ä»¥" tabindex="-1">5.1 ä¸ºå•¥Attentionçš„æ—¶å€™è¦é™¤ä»¥<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow></msqrt></mrow><annotation encoding="application/x-tex">\\sqrt{d_k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8572200000000001em;"></span><span class="strut bottom" style="height:1.04em;vertical-align:-0.18278em;"></span><span class="base textstyle uncramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.017220000000000013em;"><span class="style-wrap reset-textstyle textstyle uncramped">âˆš</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="mord textstyle cramped"><span class="mord"><span class="mord mathit">d</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span style="top:-0.77722em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼Ÿ <a class="header-anchor" href="#_5-1-ä¸ºå•¥attentionçš„æ—¶å€™è¦é™¤ä»¥" aria-label="Permalink to &quot;5.1 ä¸ºå•¥Attentionçš„æ—¶å€™è¦é™¤ä»¥$\\sqrt{d_k}$ï¼Ÿ&quot;">â€‹</a></h3><p>å½“ dk<em>d**k</em> çš„å€¼æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¸¤ç§ç‚¹ç§¯æœºåˆ¶(additive å’Œ Dot-Product)çš„æ€§èƒ½ç›¸å·®ç›¸è¿‘ï¼Œå½“ dk<em>d**k</em> æ¯”è¾ƒå¤§æ—¶ï¼Œadditive attention æ¯”ä¸å¸¦scale çš„ç‚¹ç§¯attentionæ€§èƒ½å¥½ã€‚ æˆ‘ä»¬æ€€ç–‘ï¼Œå¯¹äºå¾ˆå¤§çš„ dk<em>d**k</em> å€¼ï¼Œç‚¹ç§¯å¤§å¹…åº¦å¢é•¿ï¼Œå°†softmaxå‡½æ•°æ¨å‘å…·æœ‰æå°æ¢¯åº¦çš„åŒºåŸŸã€‚ ä¸ºäº†æŠµæ¶ˆè¿™ç§å½±å“ï¼Œæˆ‘ä»¬ç¼©å°ç‚¹ç§¯ 1dkâˆš<em>d**k</em>1 å€ã€‚</p><h3 id="_5-2-ä¸ºå•¥æ‹†å¤šå¤´-ä¸ºå•¥æ•ˆæœå¥½äº†" tabindex="-1">5.2 ä¸ºå•¥æ‹†å¤šå¤´ï¼Ÿä¸ºå•¥æ•ˆæœå¥½äº†ï¼Ÿ <a class="header-anchor" href="#_5-2-ä¸ºå•¥æ‹†å¤šå¤´-ä¸ºå•¥æ•ˆæœå¥½äº†" aria-label="Permalink to &quot;5.2 ä¸ºå•¥æ‹†å¤šå¤´ï¼Ÿä¸ºå•¥æ•ˆæœå¥½äº†ï¼Ÿ&quot;">â€‹</a></h3><h3 id="_5-3-cross-multi-head-attention" tabindex="-1">5.3 Cross Multi-Head Attentionï¼Ÿ <a class="header-anchor" href="#_5-3-cross-multi-head-attention" aria-label="Permalink to &quot;5.3 Cross Multi-Head Attentionï¼Ÿ&quot;">â€‹</a></h3><p>é¦–å…ˆï¼ŒSelf- Attentionä¸ä¼ ç»Ÿçš„Attentionæœºåˆ¶éå¸¸çš„ä¸åŒï¼šä¼ ç»Ÿçš„Attentionæ˜¯åŸºäºsourceç«¯å’Œtargetç«¯çš„éšå˜é‡ï¼ˆhidden stateï¼‰è®¡ç®—Attentionçš„ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯æºç«¯ï¼ˆsourceç«¯ï¼‰çš„æ¯ä¸ªè¯ä¸ç›®æ ‡ç«¯ï¼ˆtargetç«¯ï¼‰æ¯ä¸ªè¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å…¶æ¬¡ï¼ŒSelf-Attentioné¦–å…ˆåˆ†åˆ«åœ¨sourceç«¯å’Œtargetç«¯è¿›è¡Œè‡ªèº«çš„attentionï¼Œä»…ä¸source inputæˆ–è€…target inputè‡ªèº«ç›¸å…³çš„Self -Attentionï¼Œä»¥æ•æ‰sourceç«¯æˆ–targetç«¯è‡ªèº«çš„è¯ä¸è¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼›ç„¶åå†æŠŠsourceç«¯çš„å¾—åˆ°çš„self -AttentionåŠ å…¥åˆ°targetç«¯å¾—åˆ°çš„Attentionä¸­ï¼Œç§°ä½œä¸º<strong>Cross-Attention</strong>ï¼Œä»¥æ•æ‰sourceç«¯å’Œtargetç«¯è¯ä¸è¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><h3 id="_5-4-mask-multi-head-attention" tabindex="-1">5.4 Mask Multi-Head Attention <a class="header-anchor" href="#_5-4-mask-multi-head-attention" aria-label="Permalink to &quot;5.4 Mask Multi-Head Attention&quot;">â€‹</a></h3><p>â€‹ ä¸Encoderçš„Multi-Head Attentionè®¡ç®—åŸç†ä¸€æ ·ï¼Œåªæ˜¯å¤šåŠ äº†ä¸€ä¸ªmaskç ã€‚mask è¡¨ç¤ºæ©ç ï¼Œå®ƒå¯¹æŸäº›å€¼è¿›è¡Œæ©ç›–ï¼Œä½¿å…¶åœ¨å‚æ•°æ›´æ–°æ—¶ä¸äº§ç”Ÿæ•ˆæœã€‚Transformer æ¨¡å‹é‡Œé¢æ¶‰åŠä¸¤ç§ maskï¼Œåˆ†åˆ«æ˜¯ padding mask å’Œ sequence maskã€‚</p><h3 id="_5-5-maskingå®ç°æœºç†" tabindex="-1">5.5 Maskingå®ç°æœºç† <a class="header-anchor" href="#_5-5-maskingå®ç°æœºç†" aria-label="Permalink to &quot;5.5 Maskingå®ç°æœºç†&quot;">â€‹</a></h3><p>å…·ä½“çš„åšæ³•æ˜¯ï¼ŒæŠŠ<strong>è¿™äº›ä½ç½®</strong>çš„å€¼<strong>åŠ ä¸Šä¸€ä¸ªéå¸¸å¤§çš„è´Ÿæ•°(è´Ÿæ— ç©·)</strong>ï¼Œè¿™æ ·çš„è¯ï¼Œç»è¿‡ softmaxï¼Œè¿™äº›ä½ç½®çš„æ¦‚ç‡å°±ä¼šæ¥è¿‘0ï¼</p><h3 id="_5-6-mqaå’Œgqa" tabindex="-1">5.6 MQAå’ŒGQA <a class="header-anchor" href="#_5-6-mqaå’Œgqa" aria-label="Permalink to &quot;5.6 MQAå’ŒGQA&quot;">â€‹</a></h3><p>MQAå¤šå¤´å…±ç”¨Kï¼ŒV</p><p>GQAå°†å¤´åˆ†ç»„ï¼Œç»„å†…å…±ç”¨KV</p><h2 id="_6-ğŸŒŸğŸŒŸğŸŒŸk-v-cache" tabindex="-1">6. ğŸŒŸğŸŒŸğŸŒŸK-V Cache <a class="header-anchor" href="#_6-ğŸŒŸğŸŒŸğŸŒŸk-v-cache" aria-label="Permalink to &quot;6. ğŸŒŸğŸŒŸğŸŒŸK-V Cache&quot;">â€‹</a></h2><h2 id="_7-ğŸŒŸğŸŒŸğŸŒŸå¸¸è§çš„æ­£åˆ™åŒ–æ–¹æ³•" tabindex="-1">7. ğŸŒŸğŸŒŸğŸŒŸå¸¸è§çš„æ­£åˆ™åŒ–æ–¹æ³• <a class="header-anchor" href="#_7-ğŸŒŸğŸŒŸğŸŒŸå¸¸è§çš„æ­£åˆ™åŒ–æ–¹æ³•" aria-label="Permalink to &quot;7. ğŸŒŸğŸŒŸğŸŒŸå¸¸è§çš„æ­£åˆ™åŒ–æ–¹æ³•&quot;">â€‹</a></h2><h1 id="äºŒ-è¯¾å ‚è®°å½•" tabindex="-1">äºŒ. è¯¾å ‚è®°å½• <a class="header-anchor" href="#äºŒ-è¯¾å ‚è®°å½•" aria-label="Permalink to &quot;äºŒ. è¯¾å ‚è®°å½•&quot;">â€‹</a></h1><h2 id="ğŸŒŸ0301-0302" tabindex="-1">ğŸŒŸ0301-0302 <a class="header-anchor" href="#ğŸŒŸ0301-0302" aria-label="Permalink to &quot;ğŸŒŸ0301-0302&quot;">â€‹</a></h2><ul><li>0301:inputåºåˆ—é•¿åº¦å¤§äºembeddingæ—¶å€™çš„seq_lenæ—¶, inputçš„è¾“å…¥åºåˆ—ä¼šæŒ‰ç…§seq_lenè¿›è¡Œåˆ‡å‰²æ‹¼æ¥åˆ°batchä¸Šå—? (è€å¸ˆè®²äº†encoderæ—¶å€™inputä¸è¶³seq_lenæ—¶å€™ä½¿ç”¨maskç„¶åæƒ³é—®çš„å¦ä¸€ä¸ªé—®é¢˜)</li><li>0302:<code>K-V cache</code>æ—¶å€™å½“é¢„æµ‹ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„æ—¶å€™ä¸ä¹‹å‰çš„åšAttentionçš„æ—¶å€™, ä¸­é€”ä¼šå–å‡ºcacheé‡Œçš„Kâ€”Vå—è¿˜æ˜¯åªå–å‡ºé‡Œé¢çš„Kè¿˜æ˜¯åªåœ¨æœ€åä¸€ä¸ªç»“æŸåæ‰æ•´ä½“å–ä¸€æ¬¡ (æˆ‘æƒ³é—®çš„ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªbatchæˆ–è€…ä¸€ä¸ªseqçš„è®¿å­˜æƒ…å†µ, æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½éœ€è¦è®¿é—®cacheä¸€æ¬¡å—)</li><li>æ˜¯ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„å¡«å……çŸ©é˜µè¿˜æ˜¯éœ€è¦æ‹¿å‡ºç¼“å­˜æ•°æ®(è¯»è¿˜æ˜¯å–)</li></ul><h2 id="_0308-0309â€”â€”pytorch" tabindex="-1">0308-0309â€”â€”PyTorch <a class="header-anchor" href="#_0308-0309â€”â€”pytorch" aria-label="Permalink to &quot;0308-0309â€”â€”PyTorch&quot;">â€‹</a></h2><blockquote><p>æåŠ: æ··åˆç²¾åº¦è®­ç»ƒ</p></blockquote><h3 id="_1-1-tensor-ä¸­æ•°æ®çš„è¿ç»­æ€§" tabindex="-1">1.1 Tensor ä¸­æ•°æ®çš„è¿ç»­æ€§ <a class="header-anchor" href="#_1-1-tensor-ä¸­æ•°æ®çš„è¿ç»­æ€§" aria-label="Permalink to &quot;1.1 Tensor ä¸­æ•°æ®çš„è¿ç»­æ€§&quot;">â€‹</a></h3><p>reshape, transpose, view, T(è½¬ç½®), permute</p><p>transposeä¼šè®©raw dataä¸å˜(å…±ç”¨), mata dataçš„strideå’Œshapeç­‰å±æ€§å°±å˜äº† is_contiguous()ä¸è¿ç»­, ä½†reshapeå’Œpermuteè¿™äº›æ˜¯ä¸ä¼šå˜çš„,å› ä¸ºä»–ä»¬ä¼šå‘ç”Ÿdata copy, contiguous()ä¼šå‘ç”Ÿcopy raw dataæ•°æ®</p><p>viewå’Œreshapeçš„åŒºåˆ«</p><p>viewæ›´åŠ å®‰å…¨, ä¸ä¼šé‡æ–°æ‹·è´æ•°æ®, ä½†æ•°æ®ä¸è¿ç»­ä¸èƒ½ä½¿ç”¨view,ä¹Ÿå°±æ˜¯strideä¸åè°ƒ, reshapeä¸ä¼šé”™è¯¯, ä¼šé‡æ–°æ‹·è´æ•°æ®, æ•°æ®ä¹Ÿè¿ç»­</p><p>permuteå’Œtransposeä¼šè®©strideå±æ€§æ”¹å˜, ä»è€Œå‘ç”Ÿæ•°æ®ä¸è¿ç»­, é€šå¸¸ä½¿ç”¨åè¦åŠ ä¸€ä¸ªcontiguous()è®©æ•°æ®è¿ç»­</p><h3 id="_1-2-pytorch-autograd" tabindex="-1">1.2 pytorch autograd <a class="header-anchor" href="#_1-2-pytorch-autograd" aria-label="Permalink to &quot;1.2 pytorch autograd&quot;">â€‹</a></h3><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250308163009045.png" alt="image-20250308163009045" style="zoom:36%;"><p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p><p>å¶å­ç»“ç‚¹+requests_grad=Trueæ‰æœ‰æœ€ç»ˆçš„grad, éå¶å­ç»“ç‚¹ä¸­é€”å¯èƒ½ä¼šè®¡ç®—grad, ä½†ç”¨äº†å°±ä¼šä¸¢å¼ƒ(requests_grad=Trueçš„)</p><p>æ¢¯åº¦ç´¯åŠ ä¹Ÿæœ‰å¯èƒ½, å¤šä¸ªstepçš„æ¢¯åº¦ç´¯åŠ , éšå¼å¢åŠ batch</p><p>è‹¥æ²¡è¿›è¡Œxxx.grad.zero_()æˆ–è€…xxx.grad = None, åˆ™ä¼šè¿›è¡Œaccumulate()ç´¯åŠ grad, è¿™ä¸¤ç§æ–¹æ³•æœ‰ä¸€ç‚¹åŒºåˆ«, zero__()ä¼šç½®é›¶,ä¼šå ç”¨æ˜¾å­˜, ä½†=Noneçš„è¯ä¼šé‡Šæ”¾æ˜¾å­˜, ä¸¤è€…å„æœ‰å¥½å</p><h3 id="_1-3-inplace-op" tabindex="-1">1.3 inplace-op <a class="header-anchor" href="#_1-3-inplace-op" aria-label="Permalink to &quot;1.3 inplace-op&quot;">â€‹</a></h3><p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250309102559857.png" alt="image-20250309102559857"></p><p>å¶å­ç»“ç‚¹çš„Tensorå˜é‡ä¸èƒ½è¿›è¡Œin-placeæ“ä½œ, å› ä¸ºè¦æ›´æ–°æ¢¯åº¦çš„æ—¶å€™è¦ç”¨å¶å­ç»“ç‚¹</p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250309113212792.png" alt="image-20250309113212792" style="zoom:50%;"><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250309114217344.png" alt="image-20250309114217344" style="zoom:50%;"><p>no_grad()åº•å±‚æ˜¯åŸºäºset_grad_enable(Flase)çš„</p><h3 id="_1-4-è‡ªåŠ¨å¾®åˆ†æœºåˆ¶-auto-grad-é‡ç‚¹" tabindex="-1">1.4 è‡ªåŠ¨å¾®åˆ†æœºåˆ¶(auto grad) é‡ç‚¹ï¼š <a class="header-anchor" href="#_1-4-è‡ªåŠ¨å¾®åˆ†æœºåˆ¶-auto-grad-é‡ç‚¹" aria-label="Permalink to &quot;1.4 è‡ªåŠ¨å¾®åˆ†æœºåˆ¶(auto grad) é‡ç‚¹ï¼š&quot;">â€‹</a></h3><ul><li>pytorchä¸­ æ­£å‘forward å¯¹æˆ‘ä»¬ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œä½†æ˜¯backwardå¯¹æˆ‘ä»¬ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼›</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªæ­£å‘çš„å‡½æ•°ï¼Œéƒ½å¯¹åº”ä¸€ä¸ªåå‘çš„å‡½æ•°ï¼ˆgrad_fn--&gt; Tensorä¸­ï¼‰ï¼›</li><li>tensorï¼šrequires_grad = True</li><li>tensor: grad --&gt; tensor ä¸­å­˜å‚¨gradçš„åœ°æ–¹ï¼›</li><li>tensor: grad_fn --&gt; å­˜å‚¨æˆ‘ä»¬åå‘å‡½æ•°çš„åœ°æ–¹</li><li>tesnor: is_leaf --&gt; è¿™ä¸ªtensor æ˜¯ä¸æ˜¯ å¶å­èŠ‚ç‚¹ï¼›</li><li>net::all weight --&gt; éƒ½æ˜¯leaf</li><li>å¶å­èŠ‚ç‚¹çš„æ¢¯åº¦ä¼šè‡ªåŠ¨ä¿å­˜ä¸‹æ¥çš„ï¼ˆweightï¼‰ï¼›</li><li>ä¸­é—´çš„ activation çš„æ¢¯åº¦ä¼šè®¡ç®—ï¼Œä½†æ˜¯ä¸ä¿ç•™ï¼›</li><li>pytorch åŠ¨æ€å›¾ vs tensorflow é™æ€å›¾ï¼›</li><li>æˆ‘ä»¬ä¸èƒ½æ”¹å˜ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„ requires_grad;</li><li>éå¶å­ï¼ˆä¸€ä¸ªå‡½æ•°çš„outputï¼‰èŠ‚ç‚¹å®ƒçš„ requires_grad è‡ªåŠ¨æ¨å¯¼çš„ï¼›</li><li>éå¶å­èŠ‚ç‚¹å¯¹åº”å‡½æ•°çš„inputs ä¸­åªè¦æœ‰ä¸€ä¸ª requires_grad = True, é‚£ä¹ˆè¿™ä¸ªéå¶å­èŠ‚ç‚¹çš„requires_grad = True;</li><li>torch.no_grad() ä¼šä½¿å¾—é‡Œé¢çš„æ–°çš„tensor requires_grad = False</li><li>inplaceçš„æ“ä½œï¼Œéå¸¸å¤§çš„é£é™©ï¼šè¦†ç›–äº†åŸæ¥çš„å€¼ï¼Œå¯¼è‡´åå‘ä¼ æ’­æ—¶è®¡ç®—ä¸å‡†ç¡®ï¼›</li><li>æ ‡é‡çš„æ¢¯åº¦æ‰èƒ½è¢«éšå¼åˆ›å»ºï¼Œéšå¼åˆ›å»ºï¼ˆ.backward(1)ï¼‰ï¼›</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ.backward(gradient)æ˜¯æœ‰è¾“å…¥çš„: ;</li></ul><h3 id="_2-1-torch-nn-module" tabindex="-1">2.1 torch.nn.Module <a class="header-anchor" href="#_2-1-torch-nn-module" aria-label="Permalink to &quot;2.1 torch.nn.Module&quot;">â€‹</a></h3><p>trainæ¨¡å¼å’Œvealæ¨¡å¼ä¸ä¼šå¯¹gradçš„æƒ…å†µåšä¿®æ”¹,åªæ˜¯å¯¹è®­ç»ƒå’Œæ¨ç†çš„å¯¹åº”çš„ç®—å­åšä¸åŒçš„å¤„ç†(ç­‰ä»·å¤„ç†)</p><p>å¸¸ç”¨ç®—å­dropoutå’ŒBachNorm</p><p>xxx.cuda()çš„æ—¶å€™æ¬è¿çš„æ˜¯_parametersåˆ°cuda, è¿˜æœ‰bufferä¹Ÿæ¬è¿åˆ°cuda, å¹¶æ²¡æœ‰å°†æ¨¡å‹ç»“æ„è¿›è¡Œæ¬è¿.</p><p>æŒ‰ç…§æ·±åº¦ä¼˜å…ˆéå†sub module,å°†é‡Œé¢çš„_parameterså’Œbufferåˆ°cuda, æ•°æ®ç±»å‹è½¬æ¢ä¹Ÿæ˜¯ä¸€æ ·çš„æ“ä½œ</p><p>c++åº•å±‚å®ç°äº†ä¸€ä¸ªdispatheråˆ†å‘æœºåˆ¶,æŒ‰ç…§deviceå±æ€§åˆ†å‘, å¯¹åº”deviceä¼šè°ƒç”¨å¯¹åº”çš„fnç®—å­, è®¡ç®—éƒ¨åˆ†æ‰æ‰§è¡Œ</p><p>_parameters()é€å‚æ•°ç»™ä¼˜åŒ–å™¨çš„æ—¶å€™å°†æ‰€æœ‰çš„parametersé€åˆ°optim, ä½†æ•°æ®å…±ç”¨, åŒæ—¶æ›´æ–°</p><p>é’©å­å‡½æ•°(æ²¡å¤ªæ‡‚)</p><hr><h2 id="_0315-0316-ç»­pytorch" tabindex="-1">0315-0316ï¼ˆç»­PyTorchï¼‰ <a class="header-anchor" href="#_0315-0316-ç»­pytorch" aria-label="Permalink to &quot;0315-0316ï¼ˆç»­PyTorchï¼‰&quot;">â€‹</a></h2><h3 id="_1-1-å›é¡¾" tabindex="-1">1.1 å›é¡¾ <a class="header-anchor" href="#_1-1-å›é¡¾" aria-label="Permalink to &quot;1.1 å›é¡¾&quot;">â€‹</a></h3><p>1.Tensorç±»å’Œé‡è¦å±æ€§ 2.autogradï¼ŒåŠ¨æ€å›¾ 3.Moduleä»¥åŠå±æ€§å’Œæ–¹æ³•</p><blockquote><p>training,_parameters,_buffers,_modules(hooksæ˜¯ä¸»è¦ç”¨äºŒæ¬¡å¼€å‘ç­‰æƒ…å†µ)</p></blockquote><p>å­æ¨¡å—å•¥æ—¶å€™å®šä¹‰çš„å‘¢ï¼Ÿ</p><p>_parameters,_bufferså“ªäº›æœ‰å“ªäº›æ²¡æœ‰</p><p>å°†moduleé‡Œçš„parametersä¼ ç»™optimï¼Œä¼šé€šè¿‡è°ƒç”¨parameters()è¿›è¡Œ</p><p>ä¸€ç³»åˆ—æ–¹æ³•å…·ä½“æƒ…å†µ</p><h3 id="_1-2-é—®é¢˜åˆé›†" tabindex="-1">1.2 é—®é¢˜åˆé›† <a class="header-anchor" href="#_1-2-é—®é¢˜åˆé›†" aria-label="Permalink to &quot;1.2 é—®é¢˜åˆé›†&quot;">â€‹</a></h3><ol><li>åœ¨è®²transformerçš„padding maskçš„æ—¶å€™æƒ³åˆ°ï¼Œå¦‚æœè¾“å…¥seq_lenå¤§äºäº†å®šä¹‰çš„seq_lenï¼Œä¼šç›´æ¥æˆªæ–­è¿˜æ˜¯æˆªæ–­å†æ‹¼æ¥åˆ°ä¸‹ä¸€ä¸ªbatch</li><li>åœ¨sequence maskçš„æ—¶å€™ï¼Œå¿˜äº†è¦é—®å•¥äº†</li><li>åœ¨normalizationå±‚çš„æ—¶å€™ä¸æ˜¯æœ‰ä¸¤ä¸ªå­¦ä¹ çš„å‚æ•°å—ï¼Œè¿™ä¿©å‚æ•°æ˜¯ä¸€æ¬¡forwardè®­ç»ƒä¸€æ¬¡è¿˜æ˜¯å•ç‹¬æœ‰è‡ªå·±çš„è®­ç»ƒï¼Ÿè¿˜æœ‰ï¼Œè¿™ä¿©å‚æ•°æ˜¯å’‹æ›´æ–°çš„ï¼Ÿ</li><li>datasetä¼šè¿­ä»£çš„å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜å—ï¼Œç„¶ådataloaderå†ä¸€æ‰¹æ¬¡çš„æå–å—</li></ol><p>with torch.no_grad(): evalæ—¶å€™ç”¨ï¼Œè®¡ç®—å›¾ä¸å†è¿›è¡Œï¼Œå¯¹require_grads=Trueçš„ä¸è¿›è¡Œæ¢¯åº¦è®¡ç®—ï¼Œæ˜¾å­˜å ç”¨é‡ä¼šå‡å°‘ï¼Œactivationçš„å°±ä¼šä¸¢å¼ƒ</p><p>datasetä¼šè¿­ä»£çš„å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜å—ï¼Œç„¶ådataloaderå†ä¸€æ‰¹æ¬¡ä¸€æ‰¹æ¬¡çš„æå–å—ï¼Ÿè¿˜æ˜¯è¯´dataloaderå‡†å¤‡æ‹¿ä¸€ä¸ªbatchï¼Œç„¶ådatasetæ ¹æ®batch_sizeè¿­ä»£è·å–sizeæ¡ã€‚</p><blockquote><p>æ˜¯åè€…ï¼Œä¹Ÿå°±æ˜¯I/Oçš„æ—¶å€™ï¼Œbatch_sizeå¤ªå°çš„è¯ä¼šå¢åŠ I/Oè´Ÿæ‹…</p></blockquote><h3 id="_2-1-torch-optim" tabindex="-1">2.1 torch.optim <a class="header-anchor" href="#_2-1-torch-optim" aria-label="Permalink to &quot;2.1 torch.optim&quot;">â€‹</a></h3><p>å‚æ•°ä¼ paramçš„æ—¶å€™çš„ä¼ é€’å’Œæ‰“åŒ…æ–¹å¼</p><p>self.param_groups</p><p>==self.state==ï¼šè®­ç»ƒæ—¶å€™æ˜¾å­˜æ¶ˆè€—çš„ä¸»è¦é¡¹ï¼ˆä¼˜åŒ–å™¨çš„åŠ¨é‡é¡¹æœ‰å…³ï¼‰ ä»–æ˜¯ä¸€ä¸ªdictï¼Œkeysæ˜¯tensorï¼Œvaluesä¹Ÿæ˜¯ æ¨¡å‹</p><blockquote><p>ç§»åŠ¨æŒ‡æ•°å¹³å‡æ˜¯å•¥å¿˜äº†</p></blockquote><p>def load_state_dict</p><h3 id="_2-2-learning-rate-è°ƒæ•´æ–¹æ¡ˆ" tabindex="-1">2.2 learning rate è°ƒæ•´æ–¹æ¡ˆ <a class="header-anchor" href="#_2-2-learning-rate-è°ƒæ•´æ–¹æ¡ˆ" aria-label="Permalink to &quot;2.2 learning rate è°ƒæ•´æ–¹æ¡ˆ&quot;">â€‹</a></h3><p>Torch.optim.lr_scheduler</p><p>éœ‡è¡ç±»å‹çš„å­¦ä¹ ç‡è°ƒæ•´æ˜¯å‡å°‘è¿›å…¥å±€éƒ¨æœ€ä¼˜è§£çš„æƒ…å†µ</p><p>==çŠ¶æ€å­—å…¸==ï¼Œä¸‰ä¸ªåœ°æ–¹è§è¿‡ï¼Œéƒ½ç±»ä¼¼ï¼Œæ¨¡å‹ä¿å­˜æ—¶å€™éœ€è¦æœ‰</p><h3 id="_2-3-æ¨¡å‹ä¿å­˜å’ŒåŠ è½½" tabindex="-1">2.3 æ¨¡å‹ä¿å­˜å’ŒåŠ è½½ <a class="header-anchor" href="#_2-3-æ¨¡å‹ä¿å­˜å’ŒåŠ è½½" aria-label="Permalink to &quot;2.3 æ¨¡å‹ä¿å­˜å’ŒåŠ è½½&quot;">â€‹</a></h3><p>==åŠ¨æ€å›¾==</p><p>1.save state_dictçš„æ—¶å€™åªæœ‰å‚æ•°ï¼Œsave modelçš„æ—¶å€™æ— æ³•ç›´æ¥ä¿å­˜æ•´ä¸ªç½‘ç»œï¼Œä½†æ˜¯ä»–çš„ææ–™ï¼ˆinitï¼‰çš„é‚£äº›ä¼šä¿å­˜ï¼Œæ¨¡å‹åŠ è½½çš„æ—¶å€™èƒ½é€šè¿‡ï¼Œä½†runing timeæ—¶å€™ï¼Œforwardå¹¶æ²¡æœ‰ï¼Œå¿…é¡»å¯¼å…¥æˆ–è€…è‡ªå·±å®ç°ï¼Œéœ€è¦åŸæ¥Netçš„ç­¾åï¼ˆå…·ä½“å®šä¹‰å¯ä»¥ä¸ä¸€è‡´ï¼Œä¼šæ”¾å…¥_modulesï¼‰</p><p>2.å¦‚æœæ˜¯è‡ªå·±å†™çš„ç®—å­ï¼Œåœ¨initæ—¶å€™ä¹Ÿæ”¾å…¥_moduleså—ï¼Ÿ</p><p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/%7B6fbad3cc-1899-4404-b3b3-d91f7da5cb95%7D.png" alt="img"></p><p>3.==onnx==æ¨¡å‹ä¿å­˜å¿…é¡»è¾“å…¥å¯¹åº”çš„inputï¼Œè‡ªå·±runä¸€éï¼Œæ˜¯ä¸€ä¸ªé™æ€å›¾</p><p>4.è®­ç»ƒä¸­çš„ä¿å­˜å’ŒåŠ è½½ï¼ˆcheck pointï¼‰==æ¨¡å‹ä¿å­˜çš„å‡ ç§å‚æ•°ç±»å‹==ï¼‰</p><p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250316113313785.png" alt="image-20250316113313785"></p><h3 id="_3-1-dataset-and-dataloader" tabindex="-1">3.1 Dataset and Dataloader <a class="header-anchor" href="#_3-1-dataset-and-dataloader" aria-label="Permalink to &quot;3.1 Dataset and Dataloader&quot;">â€‹</a></h3><blockquote><p>åªå­¦ä¹ pytorchçš„ï¼Œåç»­è‡ªå·±è¡¥hfçš„é‚£äº›</p></blockquote><h3 id="_4-1-nlp" tabindex="-1">4.1 NLP <a class="header-anchor" href="#_4-1-nlp" aria-label="Permalink to &quot;4.1 NLP&quot;">â€‹</a></h3><p>GPTï¼šè‡ªç›‘ç£è®­ç»ƒå¾—åˆ°é¢„è®­ç»ƒæ¨¡å‹ï¼ˆé‡‡ç”¨è¿ç§»å­¦ä¹ ï¼‰</p><p>Bertï¼šå®Œå½¢å¡«ç©º</p><p>è¿ç§»å­¦ä¹ ï¼šé¢„è®­ç»ƒ+å¾®è°ƒï¼ˆå¾®è°ƒçš„æ•°æ®é›†å°±æ˜¯ä¸“ä¸šé¢†åŸŸçš„æ•°æ®é›†ï¼‰</p><h3 id="_4-2-bert" tabindex="-1">4.2 Bert <a class="header-anchor" href="#_4-2-bert" aria-label="Permalink to &quot;4.2 Bert&quot;">â€‹</a></h3><p>1.ä¸¤ä¸ªä»»åŠ¡ï¼šMLMå’ŒNSP</p><p>2.Embeddingï¼Œè¯åµŒå…¥</p><p>è¯ï¼Œå¥å­ï¼ˆåˆ†æ®µï¼‰ï¼Œä½ç½® åµŒå…¥</p><p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250316165604714.png" alt="image-20250316165604714"></p><blockquote><p>transformerçš„è¯åµŒå…¥å¼ç”¨ä¸‰è§’ä½ç½®åµŒå…¥</p></blockquote><p><img src="https://coderethan-1327000741.cos.ap-chengdu.myqcloud.com/blog-pics/image-20250316175009793.png" alt="image-20250316175009793"></p>',107)]))}const u=e(r,[["render",o]]);export{h as __pageData,u as default};
